@using System;
@using System.Linq;
@using Sandbox;
@using Sandbox.UI;
@using Facepunch.Hover;
@using System.Collections.Generic;

@namespace Facepunch.Hover.UI
@attribute [StyleSheet( "/ui/Ammo.scss" )]
@inherits Panel

<root>
    <div class="active-weapon">
        <label @ref="Weapon" class="weapon"></label>
        <label @ref="Inventory" class="inventory"></label>
        <div class="icon"></div>
    </div>
    <div class="grenade-count">
        <div class="icon"></div>
        <label>Grenade</label>
    </div>
</root>

@code
{
	public Label Weapon { get; set; }
	public Label Inventory { get; set; }
	public Panel Icon { get; set; }

	public override void Tick()
	{
		var player = Local.Pawn as HoverPlayer;
		if ( player == null ) return;

		var weapon = player.ActiveChild as Weapon;
		var isValid = (weapon != null && !weapon.IsMelee);

		SetClass( "active", isValid );
		SetClass("low", weapon != null && weapon.AmmoClip < 3);

		if ( !isValid ) return;

		Weapon.Text = $"{weapon.AmmoClip}";

		if ( !weapon.UnlimitedAmmo )
		{
			var inv = weapon.AvailableAmmo();
			Inventory.Text = $"/ {inv}";
			Inventory.SetClass( "active", inv >= 0 );
		}
		else
		{
			Inventory.Text = $"/ ∞";
			Inventory.SetClass( "active", true );
		}
	}
}
