@using System
@using System.Linq
@using Sandbox;
@using Sandbox.MenuSystem;
@using Sandbox.UI;
@attribute [StyleSheet]
@inherits Sandbox.UI.NavHostPanel
@implements Sandbox.Menu.IGameMenuPanel
@namespace Facepunch.Hover

<root class="@($"team_{Team.ToString().ToLower()}")">
	<div class="video"></div>
	<MenuScene Team=@Team/>
	<div class="navigator-canvas" slot="navigator-canvas"></div>
</root>

@code
{
	public Team Team => Game.InGame ? Team.None : RandomTeam;
	private Team RandomTeam { get; set; }
	
    public GameMenu()
    {
        DefaultUrl = "/";

        AddDestination( "/", typeof( FrontPage ) );
		AddDestination( "/settings", typeof( SettingsPage ) );

        BindClass( "ingame", () => Game.InGame );
        BindClass( "inlobby", () => Game.Menu?.Lobby != null);
    }

	protected override void OnParametersSet()
	{
		Game.SetRandomSeed( DateTime.Now.Second );
		RandomTeam = Game.Random.Int( 0, 1 ) == 0 ? Team.Red : Team.Blue;
		base.OnParametersSet();
	}

	protected override int BuildHash()
	{
		return HashCode.Combine( Team );
	}

	protected override void OnEvent( PanelEvent e )
	{
		if ( e.Name == "package.changed" )
		{
			StateHasChanged();
			return;
		}

		base.OnEvent( e );
	}

    [GameEvent.Menu.ServerJoined]
    public void OnServerJoined() => Navigate( "/" );

    [GameEvent.Menu.LobbyJoined]
    public void OnLobbyJoined() => Navigate( "/lobby" );

    [GameEvent.Menu.LobbyLeave]
    public void OnLobbyLeave() => Navigate( "/" );

    [GameEvent.Menu.ServerLeave]
    public void OnServerLeave() => Navigate( "/" );
}
